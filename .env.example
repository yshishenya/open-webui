# Airis/Open WebUI environment (.env.example)
#
# How this file is used:
# - Docker Compose reads `.env` for variable substitution in `docker-compose*.y*`.
# - Only variables explicitly listed under `services.airis.environment` are injected into the backend container.
# - When running the backend directly (non-Docker), `backend/open_webui/env.py` loads `.env` from repo root.
#
# Editing rules:
# - Use `KEY=value` (no spaces around `=`).
# - Keep secrets in `.env` only. Never commit `.env`.
# - Avoid inline comments after values (some dotenv parsers treat them as part of the value).
# - JSON values (e.g. LEAD_MAGNET_QUOTAS) should stay single-quoted.

####################################
# Docker Compose / Deployment
####################################

# Host port for the WebUI (maps to container port 8080).
OPEN_WEBUI_PORT=3000

# Image tag used by `docker-compose.yaml` (the `airis` service uses it as the image tag).
WEBUI_DOCKER_TAG=main

# Image repository used by `docker-compose.prod.yml` and `scripts/deploy_prod.sh`.
WEBUI_IMAGE=yshishenya/yshishenya

####################################
# Database (Postgres)
####################################

# Postgres container settings (used by `docker-compose.yaml`).
POSTGRES_DB=airis
POSTGRES_USER=airis
# IMPORTANT: this password is only applied when the Postgres data volume is initialized.
# If the container logs say "Skipping initialization", changing POSTGRES_PASSWORD here will NOT change the
# existing role password. Either reset it in Postgres (ALTER ROLE ...) or recreate the volume (`docker compose down -v`).
POSTGRES_PASSWORD=airis_password

# Host port mapping for Postgres (container:5432 -> host:${POSTGRES_PORT}).
# If you don't want to expose Postgres publicly, change/override the port mapping in compose.
POSTGRES_PORT=5432

# Optional explicit DB URL override for the backend.
# - With docker-compose, the default resolves to `postgres` (service name).
# - For local runs (non-docker), use `localhost` or your DB host.
# - Leave empty to let `docker-compose.yaml` construct it from POSTGRES_*.
DATABASE_URL=

####################################
# Security / Base URLs
####################################

# Enable authentication/authorization.
# Recommended: true for any public deployment.
WEBUI_AUTH=true

# Secret key used for sessions/tokens when auth is enabled.
# Generate a strong secret, e.g.:
#   python -c 'import secrets; print(secrets.token_hex(32))'
WEBUI_SECRET_KEY=

# Optional canonical base URL for the backend.
# Recommended in prod: https://chat.example.com
WEBUI_URL=

####################################
# Redis (optional, but recommended)
####################################

# Redis connection string (e.g. redis://redis:6379/0).
# Used for features like OAuth state, rate limiting, and some background tasks.
REDIS_URL=

####################################
# Networking / Telemetry
####################################

# CORS allowlist. Semicolon-separated origins.
# Examples:
# - Dev:  http://localhost:5173;http://localhost:8080
# - Prod: https://chat.example.com
CORS_ALLOW_ORIGIN=*

# Forwarded IPs allowlist for running behind a reverse proxy.
# Typical: 127.0.0.1 (if only the proxy can reach the container).
FORWARDED_ALLOW_IPS=*

# Disable third-party analytics/telemetry.
SCARF_NO_ANALYTICS=true
DO_NOT_TRACK=true
ANONYMIZED_TELEMETRY=false

####################################
# Providers
####################################

# Ollama backend URL for local models.
# - Leave empty to disable.
# - Examples:
#   - local:  http://localhost:11434
#   - Docker: http://host.docker.internal:11434
OLLAMA_BASE_URL=http://localhost:11434

# OpenAI (optional; can also be configured via UI/persistent config).
OPENAI_API_BASE_URL=
OPENAI_API_KEY=

# AUTOMATIC1111_BASE_URL=http://localhost:7860

####################################
# OAuth (login providers)
####################################

# Allow OAuth to auto-create users (login for existing users can still work when false).
ENABLE_OAUTH_SIGNUP=true

# If true: try to merge accounts by email across providers.
OAUTH_MERGE_ACCOUNTS_BY_EMAIL=true

# GitHub OAuth (shown on /auth when both ID and secret are set)
GITHUB_CLIENT_ID=
GITHUB_CLIENT_SECRET=
GITHUB_CLIENT_SCOPE=user:email

# Leave empty to auto-generate callback URL: /oauth/github/login/callback
GITHUB_CLIENT_REDIRECT_URI=

# VK OAuth / VK ID
VK_CLIENT_ID=
VK_CLIENT_SECRET=

# IMPORTANT: Must match the redirect configured in your VK app.
# - VK ID SDK widget (default in Airis UI): usually your public origin (e.g. https://airis.example.com)
# - Legacy VK OAuth endpoints (/api/v1/oauth/vk/login): https://<domain>/api/v1/oauth/vk/callback
VK_REDIRECT_URI=http://localhost:3000
VK_OAUTH_SCOPE=email
VK_API_VERSION=5.131

# Yandex OAuth
YANDEX_CLIENT_ID=
YANDEX_CLIENT_SECRET=
YANDEX_REDIRECT_URI=http://localhost:3000/api/v1/oauth/yandex/callback
YANDEX_OAUTH_SCOPE=login:email login:info login:avatar

# Telegram Login Widget auth
ENABLE_TELEGRAM_AUTH=false

# Bot username (with or without leading `@`).
# For backward compatibility some flows use TELEGRAM_BOT_NAME as well.
TELEGRAM_BOT_USERNAME=

# Secret bot token. Do not commit it, expose it to clients, or log it.
TELEGRAM_BOT_TOKEN=

# Legacy/compat: bot username (same value as TELEGRAM_BOT_USERNAME).
TELEGRAM_BOT_NAME=

# Optional legacy origin (rare; keep empty unless you know you need it).
TELEGRAM_AUTH_ORIGIN=

# Maximum allowed auth payload age (anti-replay), in seconds.
TELEGRAM_AUTH_MAX_AGE_SECONDS=600

# Allow auto-creating users via Telegram auth.
ENABLE_TELEGRAM_SIGNUP=false

####################################
# Email (SMTP) - optional
####################################

# Used to build verification/reset links in emails (public frontend origin).
# In most deployments this is the same as WEBUI_URL.
FRONTEND_URL=http://localhost:3000

# If SMTP_HOST is empty, email sending is treated as "not configured".
SMTP_HOST=
SMTP_PORT=25
SMTP_USERNAME=
SMTP_PASSWORD=

# Use TLS/STARTTLS when connecting to SMTP server.
SMTP_USE_TLS=true

# "From" headers for outgoing emails.
SMTP_FROM_EMAIL=noreply@example.com
SMTP_FROM_NAME=Open WebUI

####################################
# Billing / YooKassa
####################################

# Enable prepaid wallet balance (PAYG).
ENABLE_BILLING_WALLET=true

# Enable subscriptions (currently optional in Airis).
ENABLE_BILLING_SUBSCRIPTIONS=false

# Lead magnet (free periodic quota) configuration.
LEAD_MAGNET_ENABLED=false
LEAD_MAGNET_CYCLE_DAYS=30

# JSON quotas. Keep single quotes.
# Keys: tokens_input, tokens_output, images, tts_seconds, stt_seconds
LEAD_MAGNET_QUOTAS='{"tokens_input":0,"tokens_output":0,"images":0,"tts_seconds":0,"stt_seconds":0}'

# Billing defaults / guardrails.
BILLING_DEFAULT_CURRENCY=RUB
BILLING_RATE_CARD_VERSION=2025-01
BILLING_HOLD_TTL_SECONDS=900

# Fallback used by the billing estimator when the model doesn't provide a max_tokens hint.
BILLING_ESTIMATE_MAX_OUTPUT_TOKENS=512

# Top-up package amounts (kopeks), comma-separated.
BILLING_TOPUP_TTL_DAYS=365
BILLING_TOPUP_PACKAGES_KOPEKS=100000,150000,500000,1000000

# Public pricing page hints (optional).
PUBLIC_PRICING_POPULAR_MODELS=
PUBLIC_PRICING_RECOMMENDED_TEXT_MODEL=
PUBLIC_PRICING_RECOMMENDED_IMAGE_MODEL=
PUBLIC_PRICING_RECOMMENDED_AUDIO_MODEL=
PUBLIC_PRICING_RATE_CARD_MODEL_LIMIT=50

# YooKassa credentials (required for top-ups).
YOOKASSA_SHOP_ID=
YOOKASSA_SECRET_KEY=

# Optional: custom webhook secret for signature verification.
YOOKASSA_WEBHOOK_SECRET=

# Optional extra protection for the webhook endpoint (shared secret in URL):
#   https://<your-host>/api/v1/billing/webhook/yookassa?token=<secret>
YOOKASSA_WEBHOOK_TOKEN=

# Optional webhook hardening (recommended if your app receives webhooks directly from YooKassa):
# - Enable source IP allowlist verification against YooKassa documented IP ranges.
# - If you run behind a reverse proxy, enable TRUST_X_FORWARDED_FOR and ensure only the proxy
#   can reach the app (otherwise X-Forwarded-For can be spoofed).
YOOKASSA_WEBHOOK_ENFORCE_IP_ALLOWLIST=false
YOOKASSA_WEBHOOK_TRUST_X_FORWARDED_FOR=false

# Optional: extra allowed CIDRs/IPs (comma-separated), in addition to YooKassa default list.
YOOKASSA_WEBHOOK_ALLOWED_IP_RANGES=

# Optional: override YooKassa API base URL (rare).
YOOKASSA_API_URL=https://api.yookassa.ru/v3

####################################
# Compose overlays (optional)
####################################

# These variables are only used when you enable additional docker-compose overlay files
# (or run `run-compose.sh`). They are not required for a basic stack.

# docker-compose.api.yaml (expose Ollama API)
OLLAMA_WEBAPI_PORT=11434

# docker-compose.data.yaml (persist Ollama data)
OLLAMA_DATA_DIR=./ollama-data

# docker-compose.gpu.yaml (GPU settings used by `run-compose.sh`)
OLLAMA_GPU_DRIVER=nvidia
OLLAMA_GPU_COUNT=1

# docker-compose.amdgpu.yaml (AMD ROCm tweak; advanced)
HSA_OVERRIDE_GFX_VERSION=11.0.0

# docker-compose.amdgpu.yaml / ollama image tag (default: latest / rocm)
OLLAMA_DOCKER_TAG=latest

# docker-compose.dev.yaml (dev overlay ports)
OPEN_WEBUI_API_PORT=8080
AIRIS_FRONTEND_PORT=5173
