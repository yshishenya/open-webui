services:
  postgres:
    image: postgres:16-alpine
    container_name: open-webui-postgres
    environment:
      POSTGRES_USER: openwebui
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-openwebui_password}
      POSTGRES_DB: openwebui
    volumes:
      - ./postgres-data:/var/lib/postgresql/data
    ports:
      - "5432:5432"
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U openwebui"]
      interval: 10s
      timeout: 5s
      retries: 5

  open-webui:
    image: ghcr.io/open-webui/open-webui:${WEBUI_DOCKER_TAG-main}
    container_name: open-webui
    depends_on:
      postgres:
        condition: service_healthy
    volumes:
      - ./open-webui-data:/app/backend/data
    ports:
      - ${OPEN_WEBUI_PORT-3287}:8080
    environment:
      - 'WEBUI_SECRET_KEY=${WEBUI_SECRET_KEY}'
      - 'ENABLE_FORWARD_USER_INFO_HEADERS=true'
      - 'DATABASE_URL=postgresql://openwebui:${POSTGRES_PASSWORD:-openwebui_password}@postgres:5432/openwebui'
    extra_hosts:
      - host.docker.internal:host-gateway
    restart: unless-stopped
  tika:
    image: apache/tika:latest-full
    container_name: tika
    ports:
      - "9998:9998"
    restart: unless-stopped
